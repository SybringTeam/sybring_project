@using sybring_project.Models.ViewModels

@model TimeHistoryViewModel



@{
    ViewData["Title"] = "Time History";
}

<h1>Time History Records</h1>

@using (Html.BeginForm("SelectUserAndDate", "Time", FormMethod.Post, new { id = "timeHistoryForm" }))
{
    <div class="mb-3">
        @if (User.IsInRole("admin") || User.IsInRole("superadmin"))
        {
            <div class="mb-3">
                @Html.Label("selectedUserId", "Select User:")
                @Html.DropDownList("selectedUserId", Model.UserList, "Select User", new { @class = "form-select", onchange = "submitForm()" })
            </div>
        }
        @if (User.IsInRole("underconsult"))
        {
            <label>User:</label>
            <span>@Model.CurrentUser</span>
        }
    </div>

    <div class="mb-3">
        @Html.Label("selectedDateRange", "Select Date Range:")
        @Html.DropDownList("selectedDateRange", Model.DateRanges, "Select Date Range", new { @class = "form-select", onchange = "submitForm()" })
    </div>

    <button type="submit" class="btn btn-primary">Show Time History</button>
}

@if (!string.IsNullOrEmpty(ViewBag.ErrorMessage))
{
    <div class="alert alert-danger">
        @ViewBag.ErrorMessage
    </div>
}

<div class="filter-section mb-4">
    <!-- Any additional filter section content can be added here -->
</div>

<div class="card p-3">
    @if (Model.TimeHistories.Any())
    {
        <div class="summary-section mb-4">
            <!-- Summary section content can be added here -->
        </div>

        <table id="timeHistoryTable" class="table table-striped table-bordered">
            <thead>
                <tr>
                    <th>Date</th>
                    <th>Total Working Hours</th>
                </tr>
            </thead>
            <tbody>
                @foreach (var timeHistory in Model.TimeHistories)
                {
                    <tr>
                        <td>@timeHistory.Date.ToShortDateString()</td>
                        <td>@timeHistory.TotalWorkingHours</td>
                    </tr>
                }
            </tbody>
            <tfoot>
                <tr>
                    <td><strong>Total Hours for Selected Period</strong></td>
                    <td><strong>@Model.TimeHistories.Sum(th => th.TotalWorkingHours)</strong></td>
                </tr>
            </tfoot>
        </table>

        <div class="pagination-container">
            <!-- Pagination controls can be added here if needed -->
        </div>
    }
    else
    {
        <p>No time history records found.</p>
    }
</div>

@section Scripts
{
    <script>
        $(document).ready(function () {
            $('#timeHistoryTable').DataTable({
                "scrollY": "500px",
                "scrollCollapse": false,
                "paging": true,
                "searching": false,
                "select": false
                 responsive: true

            });
        });
    </script>
}
